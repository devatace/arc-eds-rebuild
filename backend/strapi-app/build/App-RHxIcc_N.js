import{f2 as Ie,ej as $e,j as r,eV as se,k as _,f3 as de,dw as H,f4 as ze,d as X,F as D,T as A,aG as Se,a2 as De,C as ie,df as ke,h as He,bn as Me,v as ce,s as ue,U as Qe,f as me,f5 as fe,w as We,f6 as Ue,f7 as Ve,P as Y,aO as pe,bH as _e,bI as Ge,f8 as Ze,y as Oe,cV as ge,o as Ye,f9 as Ke,aR as Je,A as le,co as ye,b as Xe,bA as qe,eH as ea,bu as aa,a5 as Ae,n as ta,ak as ra,fa as na,fb as sa,aF as ia,m as la,aU as oa,aV as da,bR as Q,X as ca,Y as W,fc as ua,fd as ee,cD as ae,H as J,fe as fa,ff as pa,R as ga,N as be}from"./strapi-CGAa_rXE.js";import{f as xe}from"./index-B1IbP_Hu.js";import{u as ha,a as ma,R as ya,g as ba,b as xa}from"./ReleasesPage-9ZJXGzem.js";import"./index-BRVyLNfZ.js";import"./schemas-Dmg2f-AD.js";import"./index-CGh3H2bW.js";var va=String.prototype.replace,ja=/%20/g,te={RFC1738:"RFC1738",RFC3986:"RFC3986"},he={default:te.RFC3986,formatters:{RFC1738:function(n){return va.call(n,ja,"+")},RFC3986:function(n){return String(n)}},RFC1738:te.RFC1738,RFC3986:te.RFC3986},Ra=he,re=Object.prototype.hasOwnProperty,k=Array.isArray,B=function(){for(var n=[],e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n}(),wa=function(e){for(;e.length>1;){var a=e.pop(),t=a.obj[a.prop];if(k(t)){for(var s=[],l=0;l<t.length;++l)typeof t[l]<"u"&&s.push(t[l]);a.obj[a.prop]=s}}},Ce=function(e,a){for(var t=a&&a.plainObjects?Object.create(null):{},s=0;s<e.length;++s)typeof e[s]<"u"&&(t[s]=e[s]);return t},Sa=function n(e,a,t){if(!a)return e;if(typeof a!="object"){if(k(e))e.push(a);else if(e&&typeof e=="object")(t&&(t.plainObjects||t.allowPrototypes)||!re.call(Object.prototype,a))&&(e[a]=!0);else return[e,a];return e}if(!e||typeof e!="object")return[e].concat(a);var s=e;return k(e)&&!k(a)&&(s=Ce(e,t)),k(e)&&k(a)?(a.forEach(function(l,i){if(re.call(e,i)){var c=e[i];c&&typeof c=="object"&&l&&typeof l=="object"?e[i]=n(c,l,t):e.push(l)}else e[i]=l}),e):Object.keys(a).reduce(function(l,i){var c=a[i];return re.call(l,i)?l[i]=n(l[i],c,t):l[i]=c,l},s)},Da=function(e,a){return Object.keys(a).reduce(function(t,s){return t[s]=a[s],t},e)},Ma=function(n,e,a){var t=n.replace(/\+/g," ");if(a==="iso-8859-1")return t.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(t)}catch{return t}},Oa=function(e,a,t,s,l){if(e.length===0)return e;var i=e;if(typeof e=="symbol"?i=Symbol.prototype.toString.call(e):typeof e!="string"&&(i=String(e)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(g){return"%26%23"+parseInt(g.slice(2),16)+"%3B"});for(var c="",d=0;d<i.length;++d){var o=i.charCodeAt(d);if(o===45||o===46||o===95||o===126||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122||l===Ra.RFC1738&&(o===40||o===41)){c+=i.charAt(d);continue}if(o<128){c=c+B[o];continue}if(o<2048){c=c+(B[192|o>>6]+B[128|o&63]);continue}if(o<55296||o>=57344){c=c+(B[224|o>>12]+B[128|o>>6&63]+B[128|o&63]);continue}d+=1,o=65536+((o&1023)<<10|i.charCodeAt(d)&1023),c+=B[240|o>>18]+B[128|o>>12&63]+B[128|o>>6&63]+B[128|o&63]}return c},Aa=function(e){for(var a=[{obj:{o:e},prop:"o"}],t=[],s=0;s<a.length;++s)for(var l=a[s],i=l.obj[l.prop],c=Object.keys(i),d=0;d<c.length;++d){var o=c[d],g=i[o];typeof g=="object"&&g!==null&&t.indexOf(g)===-1&&(a.push({obj:i,prop:o}),t.push(g))}return wa(a),e},Ca=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},Ea=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},Ta=function(e,a){return[].concat(e,a)},Pa=function(e,a){if(k(e)){for(var t=[],s=0;s<e.length;s+=1)t.push(a(e[s]));return t}return a(e)},Ee={arrayToObject:Ce,assign:Da,combine:Ta,compact:Aa,decode:Ma,encode:Oa,isBuffer:Ea,isRegExp:Ca,maybeMap:Pa,merge:Sa},Te=Ie,K=Ee,Z=he,Ba=Object.prototype.hasOwnProperty,ve={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,a){return e+"["+a+"]"},repeat:function(e){return e}},$=Array.isArray,Na=Array.prototype.push,Pe=function(n,e){Na.apply(n,$(e)?e:[e])},Fa=Date.prototype.toISOString,je=Z.default,w={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:K.encode,encodeValuesOnly:!1,format:je,formatter:Z.formatters[je],indices:!1,serializeDate:function(e){return Fa.call(e)},skipNulls:!1,strictNullHandling:!1},La=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},ne={},Ia=function n(e,a,t,s,l,i,c,d,o,g,x,y,m,h,M,N){for(var f=e,E=N,S=0,p=!1;(E=E.get(ne))!==void 0&&!p;){var z=E.get(e);if(S+=1,typeof z<"u"){if(z===S)throw new RangeError("Cyclic object value");p=!0}typeof E.get(ne)>"u"&&(S=0)}if(typeof d=="function"?f=d(a,f):f instanceof Date?f=x(f):t==="comma"&&$(f)&&(f=K.maybeMap(f,function(I){return I instanceof Date?x(I):I})),f===null){if(l)return c&&!h?c(a,w.encoder,M,"key",y):a;f=""}if(La(f)||K.isBuffer(f)){if(c){var O=h?a:c(a,w.encoder,M,"key",y);return[m(O)+"="+m(c(f,w.encoder,M,"value",y))]}return[m(a)+"="+m(String(f))]}var v=[];if(typeof f>"u")return v;var T;if(t==="comma"&&$(f))h&&c&&(f=K.maybeMap(f,c)),T=[{value:f.length>0?f.join(",")||null:void 0}];else if($(d))T=d;else{var F=Object.keys(f);T=o?F.sort(o):F}for(var P=s&&$(f)&&f.length===1?a+"[]":a,L=0;L<T.length;++L){var u=T[L],b=typeof u=="object"&&typeof u.value<"u"?u.value:f[u];if(!(i&&b===null)){var R=$(f)?typeof t=="function"?t(P,u):P:P+(g?"."+u:"["+u+"]");N.set(e,S);var C=Te();C.set(ne,N),Pe(v,n(b,R,t,s,l,i,t==="comma"&&h&&$(f)?null:c,d,o,g,x,y,m,h,M,C))}}return v},$a=function(e){if(!e)return w;if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var a=e.charset||w.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=Z.default;if(typeof e.format<"u"){if(!Ba.call(Z.formatters,e.format))throw new TypeError("Unknown format option provided.");t=e.format}var s=Z.formatters[t],l=w.filter;return(typeof e.filter=="function"||$(e.filter))&&(l=e.filter),{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:w.addQueryPrefix,allowDots:typeof e.allowDots>"u"?w.allowDots:!!e.allowDots,charset:a,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:w.charsetSentinel,delimiter:typeof e.delimiter>"u"?w.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:w.encode,encoder:typeof e.encoder=="function"?e.encoder:w.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:w.encodeValuesOnly,filter:l,format:t,formatter:s,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:w.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:w.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:w.strictNullHandling}},za=function(n,e){var a=n,t=$a(e),s,l;typeof t.filter=="function"?(l=t.filter,a=l("",a)):$(t.filter)&&(l=t.filter,s=l);var i=[];if(typeof a!="object"||a===null)return"";var c;e&&e.arrayFormat in ve?c=e.arrayFormat:e&&"indices"in e?c=e.indices?"indices":"repeat":c="indices";var d=ve[c];if(e&&"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var o=d==="comma"&&e&&e.commaRoundTrip;s||(s=Object.keys(a)),t.sort&&s.sort(t.sort);for(var g=Te(),x=0;x<s.length;++x){var y=s[x];t.skipNulls&&a[y]===null||Pe(i,Ia(a[y],y,d,o,t.strictNullHandling,t.skipNulls,t.encode?t.encoder:null,t.filter,t.sort,t.allowDots,t.serializeDate,t.format,t.formatter,t.encodeValuesOnly,t.charset,g))}var m=i.join(t.delimiter),h=t.addQueryPrefix===!0?"?":"";return t.charsetSentinel&&(t.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),m.length>0?h+m:""},V=Ee,oe=Object.prototype.hasOwnProperty,ka=Array.isArray,j={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:V.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Ha=function(n){return n.replace(/&#(\d+);/g,function(e,a){return String.fromCharCode(parseInt(a,10))})},Be=function(n,e){return n&&typeof n=="string"&&e.comma&&n.indexOf(",")>-1?n.split(","):n},Qa="utf8=%26%2310003%3B",Wa="utf8=%E2%9C%93",Ua=function(e,a){var t={},s=a.ignoreQueryPrefix?e.replace(/^\?/,""):e,l=a.parameterLimit===1/0?void 0:a.parameterLimit,i=s.split(a.delimiter,l),c=-1,d,o=a.charset;if(a.charsetSentinel)for(d=0;d<i.length;++d)i[d].indexOf("utf8=")===0&&(i[d]===Wa?o="utf-8":i[d]===Qa&&(o="iso-8859-1"),c=d,d=i.length);for(d=0;d<i.length;++d)if(d!==c){var g=i[d],x=g.indexOf("]="),y=x===-1?g.indexOf("="):x+1,m,h;y===-1?(m=a.decoder(g,j.decoder,o,"key"),h=a.strictNullHandling?null:""):(m=a.decoder(g.slice(0,y),j.decoder,o,"key"),h=V.maybeMap(Be(g.slice(y+1),a),function(M){return a.decoder(M,j.decoder,o,"value")})),h&&a.interpretNumericEntities&&o==="iso-8859-1"&&(h=Ha(h)),g.indexOf("[]=")>-1&&(h=ka(h)?[h]:h),oe.call(t,m)?t[m]=V.combine(t[m],h):t[m]=h}return t},Va=function(n,e,a,t){for(var s=t?e:Be(e,a),l=n.length-1;l>=0;--l){var i,c=n[l];if(c==="[]"&&a.parseArrays)i=[].concat(s);else{i=a.plainObjects?Object.create(null):{};var d=c.charAt(0)==="["&&c.charAt(c.length-1)==="]"?c.slice(1,-1):c,o=parseInt(d,10);!a.parseArrays&&d===""?i={0:s}:!isNaN(o)&&c!==d&&String(o)===d&&o>=0&&a.parseArrays&&o<=a.arrayLimit?(i=[],i[o]=s):d!=="__proto__"&&(i[d]=s)}s=i}return s},_a=function(e,a,t,s){if(e){var l=t.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/,c=/(\[[^[\]]*])/g,d=t.depth>0&&i.exec(l),o=d?l.slice(0,d.index):l,g=[];if(o){if(!t.plainObjects&&oe.call(Object.prototype,o)&&!t.allowPrototypes)return;g.push(o)}for(var x=0;t.depth>0&&(d=c.exec(l))!==null&&x<t.depth;){if(x+=1,!t.plainObjects&&oe.call(Object.prototype,d[1].slice(1,-1))&&!t.allowPrototypes)return;g.push(d[1])}return d&&g.push("["+l.slice(d.index)+"]"),Va(g,a,t,s)}},Ga=function(e){if(!e)return j;if(e.decoder!==null&&e.decoder!==void 0&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var a=typeof e.charset>"u"?j.charset:e.charset;return{allowDots:typeof e.allowDots>"u"?j.allowDots:!!e.allowDots,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:j.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:j.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:j.arrayLimit,charset:a,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:j.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:j.comma,decoder:typeof e.decoder=="function"?e.decoder:j.decoder,delimiter:typeof e.delimiter=="string"||V.isRegExp(e.delimiter)?e.delimiter:j.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:j.depth,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:j.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:j.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:j.plainObjects,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:j.strictNullHandling}},Za=function(n,e){var a=Ga(e);if(n===""||n===null||typeof n>"u")return a.plainObjects?Object.create(null):{};for(var t=typeof n=="string"?Ua(n,a):n,s=a.plainObjects?Object.create(null):{},l=Object.keys(t),i=0;i<l.length;++i){var c=l[i],d=_a(c,t[c],a,typeof n=="string");s=V.merge(s,d,a)}return a.allowSparse===!0?s:V.compact(s)},Ya=za,Ka=Za,Ja=he,Xa={formats:Ja,parse:Ka,stringify:Ya};const qa=X(D)`
  width: 100%;
  max-width: 256px;

  & > * {
    border-bottom: 1px solid ${({theme:n})=>n.colors.neutral150};
  }

  & > *:last-child {
    border-bottom: none;
  }
`,et=X(D)`
  svg {
    fill: currentColor;
  }
`,U=({children:n,icon:e,color:a})=>r.jsx(se.Trigger,{children:r.jsx(ie,{variant:"ghost",endIcon:r.jsx(ke,{}),children:r.jsxs(et,{color:a,gap:2,children:[e,r.jsx(A,{textColor:a,variant:"omega",fontWeight:"bold",children:n})]})})}),at=({action:n,status:e,hasErrors:a,requiredStage:t,entryStage:s})=>{const{formatMessage:l}=_();return n==="publish"?a||t&&t.id!==s?.id?r.jsx(U,{icon:r.jsx(de,{}),color:"danger600",children:l({id:"content-releases.pages.ReleaseDetails.entry-validation.not-ready",defaultMessage:"Not ready to publish"})}):e==="draft"?r.jsx(U,{icon:r.jsx(H,{}),color:"success600",children:l({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-publish",defaultMessage:"Ready to publish"})}):e==="modified"?r.jsx(U,{icon:r.jsx(ze,{}),color:"alternative600",children:l({id:"content-releases.pages.ReleaseDetails.entry-validation.modified",defaultMessage:"Ready to publish changes"})}):r.jsx(U,{icon:r.jsx(H,{}),color:"success600",children:l({id:"content-releases.pages.ReleaseDetails.entry-validation.already-published",defaultMessage:"Already published"})}):e==="published"?r.jsx(U,{icon:r.jsx(H,{}),color:"success600",children:l({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-unpublish",defaultMessage:"Ready to unpublish"})}):r.jsx(U,{icon:r.jsx(H,{}),color:"success600",children:l({id:"content-releases.pages.ReleaseDetails.entry-validation.already-unpublished",defaultMessage:"Already unpublished"})})},tt=({hasErrors:n,errors:e,kind:a,contentTypeUid:t,documentId:s,locale:l})=>{const{formatMessage:i}=_();return r.jsxs(D,{direction:"column",gap:1,width:"100%",padding:5,children:[r.jsxs(D,{gap:2,width:"100%",children:[r.jsx(A,{fontWeight:"bold",children:i({id:"content-releases.pages.ReleaseDetails.entry-validation.fields",defaultMessage:"Fields"})}),n?r.jsx(de,{fill:"danger600"}):r.jsx(H,{fill:"success600"})]}),r.jsx(A,{width:"100%",textColor:"neutral600",children:n?i({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.error",defaultMessage:"{errors} errors on fields."},{errors:e?Object.keys(e).length:0}):i({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.success",defaultMessage:"All fields are filled correctly."})}),n&&r.jsx(Se,{tag:De,to:{pathname:`/content-manager/${a==="collectionType"?"collection-types":"single-types"}/${t}/${s}`,search:l?Xa.stringify({plugins:{i18n:{locale:l}}}):""},variant:"secondary",fullWidth:!0,state:{forceValidation:!0},children:i({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.see-errors",defaultMessage:"See errors"})})]})},rt=({contentTypeHasReviewWorkflow:n,requiredStage:e,entryStage:a})=>n?e&&e.id!==a?.id?r.jsx(de,{fill:"danger600"}):r.jsx(H,{fill:"success600"}):r.jsx(H,{fill:"neutral200"}),nt=({contentTypeHasReviewWorkflow:n,requiredStage:e,entryStage:a,formatMessage:t})=>n?e&&e.id!==a?.id?t({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.not-ready",defaultMessage:"This entry is not at the required stage for publishing. ({stageName})"},{stageName:e?.name??""}):e&&e.id===a?.id?t({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.ready",defaultMessage:"This entry is at the required stage for publishing. ({stageName})"},{stageName:e?.name??""}):t({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.stage-not-required",defaultMessage:"No required stage for publication"}):t({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.not-enabled",defaultMessage:"This entry is not associated to any workflow."}),st=({contentTypeHasReviewWorkflow:n,requiredStage:e,entryStage:a})=>{const{formatMessage:t}=_(),s=rt({contentTypeHasReviewWorkflow:n,requiredStage:e,entryStage:a});return r.jsxs(D,{direction:"column",gap:1,width:"100%",padding:5,children:[r.jsxs(D,{gap:2,width:"100%",children:[r.jsx(A,{fontWeight:"bold",children:t({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage",defaultMessage:"Review stage"})}),s]}),r.jsx(A,{textColor:"neutral600",children:nt({contentTypeHasReviewWorkflow:n,requiredStage:e,entryStage:a,formatMessage:t})})]})},it=({schema:n,entry:e,status:a,action:t})=>{const{validate:s,isLoading:l}=$e({collectionType:n?.kind??"",model:n?.uid??""},{skip:!0}),i=l?null:s(e),c=i?Object.keys(i).length>0:!1,d=n?.hasReviewWorkflow??!1,o=n?.stageRequiredToPublish,g=e.strapi_stage;return l?null:r.jsxs(se.Root,{children:[r.jsx(at,{action:t,status:a,hasErrors:c,requiredStage:o,entryStage:g}),r.jsx(se.Content,{children:r.jsxs(qa,{direction:"column",children:[r.jsx(tt,{hasErrors:c,errors:i,contentTypeUid:n?.uid,kind:n?.kind,documentId:e.documentId,locale:e.locale}),r.jsx(st,{contentTypeHasReviewWorkflow:d,requiredStage:o,entryStage:g})]})})]})},lt=He,Ne=n=>typeof n<"u"&&n.name!==void 0,ot=X(D)`
  align-self: stretch;
  border-bottom-right-radius: ${({theme:n})=>n.borderRadius};
  border-bottom-left-radius: ${({theme:n})=>n.borderRadius};
  border-top: 1px solid ${({theme:n})=>n.colors.neutral150};
`,Re=({toggleEditReleaseModal:n,toggleWarningSubmit:e,children:a})=>{const{formatMessage:t,formatDate:s,formatTime:l}=_(),{releaseId:i}=Me(),{data:c,isLoading:d,error:o}=fe({id:i},{skip:!i}),[g,{isLoading:x}]=Ze(),{toggleNotification:y}=ce(),{formatAPIError:m}=ue(),{allowedActions:h}=Oe(ge),{canUpdate:M,canDelete:N,canPublish:f}=h,E=lt(),{trackUsage:S}=Ye(),p=c?.data,z=b=>async()=>{const R=await g({id:b});if("data"in R){y({type:"success",message:t({id:"content-releases.pages.ReleaseDetails.publish-notification-success",defaultMessage:"Release was published successfully."})});const{totalEntries:C,totalPublishedEntries:I,totalUnpublishedEntries:G}=R.data.meta;S("didPublishRelease",{totalEntries:C,totalPublishedEntries:I,totalUnpublishedEntries:G})}else J(R.error)?y({type:"danger",message:m(R.error)}):y({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})},O=()=>{E(pa.util.invalidateTags([{type:"ReleaseAction",id:"LIST"},{type:"Release",id:i}]))},v=()=>p?.createdBy?p.createdBy.username?p.createdBy.username:p.createdBy.firstname?`${p.createdBy.firstname} ${p.createdBy.lastname||""}`.trim():p.createdBy.email:null;if(d)return r.jsx(Y.Loading,{});if(Ne(o)&&"code"in o||!p)return r.jsx(pe,{to:"..",state:{errors:[{code:o?.code}]}});const T=p.actions.meta.count||0,F=!!v(),P=p.scheduledAt&&p.timezone,L=t({id:"content-releases.pages.Details.header-subtitle",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:T}),u=P?t({id:"content-releases.pages.ReleaseDetails.header-subtitle.scheduled",defaultMessage:"Scheduled for {date} at {time} ({offset})"},{date:s(new Date(p.scheduledAt),{weekday:"long",day:"numeric",month:"long",year:"numeric",timeZone:p.timezone}),time:l(new Date(p.scheduledAt),{timeZone:p.timezone,hourCycle:"h23"}),offset:Ke(p.timezone,new Date(p.scheduledAt))}):"";return r.jsxs(Je,{"aria-busy":d,children:[r.jsx(le.Header,{title:p.name,subtitle:r.jsxs(D,{gap:2,lineHeight:6,children:[r.jsx(A,{textColor:"neutral600",variant:"epsilon",children:L+(P?` - ${u}`:"")}),r.jsx(Ae,{...ba(p.status),children:p.status})]}),navigationAction:r.jsx(aa,{fallback:".."}),primaryAction:!p.releasedAt&&r.jsxs(D,{gap:2,children:[r.jsxs(dt,{label:r.jsx(ea,{}),variant:"tertiary",endIcon:null,paddingLeft:"7px",paddingRight:"7px","aria-label":t({id:"content-releases.header.actions.open-release-actions",defaultMessage:"Release edit and delete menu"}),popoverPlacement:"bottom-end",children:[r.jsx(ye.Item,{disabled:!M,onSelect:n,startIcon:r.jsx(Xe,{}),children:t({id:"content-releases.header.actions.edit",defaultMessage:"Edit"})}),r.jsx(ye.Item,{disabled:!N,onSelect:e,variant:"danger",startIcon:r.jsx(qe,{}),children:t({id:"content-releases.header.actions.delete",defaultMessage:"Delete"})}),r.jsxs(ot,{direction:"column",justifyContent:"center",alignItems:"flex-start",gap:1,padding:4,children:[r.jsx(A,{variant:"pi",fontWeight:"bold",children:t({id:"content-releases.header.actions.created",defaultMessage:"Created"})}),r.jsxs(A,{variant:"pi",color:"neutral300",children:[r.jsx(ya,{timestamp:new Date(p.createdAt)}),t({id:"content-releases.header.actions.created.description",defaultMessage:"{hasCreatedByUser, select, true { by {createdBy}} other { by deleted user}}"},{createdBy:v(),hasCreatedByUser:F})]})]})]}),r.jsx(ie,{size:"S",variant:"tertiary",onClick:O,children:t({id:"content-releases.header.actions.refresh",defaultMessage:"Refresh"})}),f?r.jsx(ie,{size:"S",variant:"default",onClick:z(p.id.toString()),loading:x,disabled:p.actions.meta.count===0,children:t({id:"content-releases.header.actions.publish",defaultMessage:"Publish"})}):null]})}),a]})},dt=X(fa)`
  & > span {
    display: flex;
  }
`,ct=["contentType","locale","action"],ut=["contentType","action"],we=n=>n==="locale"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.locales",defaultMessage:"Locales"}:n==="action"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.actions",defaultMessage:"Actions"}:{id:"content-releases.pages.ReleaseDetails.groupBy.option.content-type",defaultMessage:"Content-Types"},ft=({releaseId:n})=>{const{formatMessage:e}=_(),[{query:a},t]=ta(),{toggleNotification:s}=ce(),{formatAPIError:l}=ue(),{data:i,isLoading:c,error:d}=fe({id:n}),{allowedActions:{canUpdate:o}}=Oe(ge),g=ra("ReleaseDetailsPage",u=>u.runHookWaterfall),{displayedHeaders:x,hasI18nEnabled:y}=g("ContentReleases/pages/ReleaseDetails/add-locale-in-releases",{displayedHeaders:[{label:{id:"content-releases.page.ReleaseDetails.table.header.label.name",defaultMessage:"name"},name:"name"}],hasI18nEnabled:!1}),m=i?.data,h=a?.groupBy||"contentType",{isLoading:M,isFetching:N,isError:f,data:E,error:S}=na({...a,releaseId:n}),[p]=sa(),z=async(u,b,R)=>{const C=await p({params:{releaseId:n,actionId:b},body:{type:u.target.value},query:a,actionPath:R});"error"in C&&(J(C.error)?s({type:"danger",message:l(C.error)}):s({type:"danger",message:e({id:"notification.error",defaultMessage:"An error occurred"})}))};if(M||c)return r.jsx(Y.Loading,{});const O=E?.data,v=E?.meta,T=v?.contentTypes||{};if(v?.components,Ne(d)||!m){const u=[];return d&&"code"in d&&u.push({code:d.code}),S&&"code"in S&&u.push({code:S.code}),r.jsx(pe,{to:"..",state:{errors:u}})}if(f||!O)return r.jsx(Y.Error,{});if(Object.keys(O).length===0)return r.jsx(le.Content,{children:r.jsx(ia,{action:r.jsx(Se,{tag:De,to:{pathname:"/content-manager"},style:{textDecoration:"none"},variant:"secondary",children:e({id:"content-releases.page.Details.button.openContentManager",defaultMessage:"Open the Content Manager"})}),icon:r.jsx(la,{width:"16rem"}),content:e({id:"content-releases.pages.Details.tab.emptyEntries",defaultMessage:"This release is empty. Open the Content Manager, select an entry and add it to the release."})})});const F=e({id:"content-releases.pages.ReleaseDetails.groupBy.aria-label",defaultMessage:"Group by"}),P=[...x,{label:{id:"content-releases.page.ReleaseDetails.table.header.label.content-type",defaultMessage:"content-type"},name:"content-type"},{label:{id:"content-releases.page.ReleaseDetails.table.header.label.action",defaultMessage:"action"},name:"action"},...m.releasedAt?[]:[{label:{id:"content-releases.page.ReleaseDetails.table.header.label.status",defaultMessage:"status"},name:"status"}]],L=y?ct:ut;return r.jsx(le.Content,{children:r.jsxs(D,{gap:8,direction:"column",alignItems:"stretch",children:[r.jsx(D,{children:r.jsx(oa,{placeholder:F,"aria-label":F,customizeContent:u=>e({id:"content-releases.pages.ReleaseDetails.groupBy.label",defaultMessage:"Group by {groupBy}"},{groupBy:u}),value:e(we(h)),onChange:u=>t({groupBy:u}),children:L.map(u=>r.jsx(da,{value:u,children:e(we(u))},u))})}),Object.keys(O).map(u=>r.jsxs(D,{gap:4,direction:"column",alignItems:"stretch",children:[r.jsx(D,{role:"separator","aria-label":u,children:r.jsx(Ae,{children:u})}),r.jsx(Q.Root,{rows:O[u].map(b=>({...b,id:Number(b.entry.id)})),headers:P,isLoading:M||N,children:r.jsxs(Q.Content,{children:[r.jsx(Q.Head,{children:P.map(({label:b,name:R})=>r.jsx(Q.HeaderCell,{label:e(b),name:R},R))}),r.jsx(Q.Loading,{}),r.jsx(Q.Body,{children:O[u].map(({id:b,contentType:R,locale:C,type:I,entry:G,status:Fe},Le)=>r.jsxs(ca,{children:[r.jsx(W,{width:"25%",maxWidth:"200px",children:r.jsx(A,{ellipsis:!0,children:`${R.mainFieldValue||G.id}`})}),y&&r.jsx(W,{width:"10%",children:r.jsx(A,{children:`${C?.name?C.name:"-"}`})}),r.jsx(W,{width:"10%",children:r.jsx(A,{children:R.displayName||""})}),r.jsx(W,{width:"20%",children:m.releasedAt?r.jsx(A,{children:e({id:"content-releases.page.ReleaseDetails.table.action-published",defaultMessage:"This entry was <b>{isPublish, select, true {published} other {unpublished}}</b>."},{isPublish:I==="publish",b:q=>r.jsx(A,{fontWeight:"bold",children:q})})}):r.jsx(ua,{selected:I,handleChange:q=>z(q,b,[u,Le]),name:`release-action-${b}-type`,disabled:!o})}),!m.releasedAt&&r.jsxs(r.Fragment,{children:[r.jsx(W,{width:"20%",minWidth:"200px",children:r.jsx(it,{action:I,schema:T?.[R.uid],entry:G,status:Fe})}),r.jsx(W,{children:r.jsx(D,{justifyContent:"flex-end",children:r.jsxs(ee.Root,{children:[r.jsx(ee.ReleaseActionEntryLinkItem,{contentTypeUid:R.uid,documentId:G.documentId,locale:C?.code}),r.jsx(ee.DeleteReleaseActionItem,{releaseId:m.id,actionId:b})]})})})]})]},b))})]})})]},`releases-group-${u}`)),r.jsxs(ae.Root,{...v?.pagination,defaultPageSize:v?.pagination?.pageSize,children:[r.jsx(ae.PageSize,{}),r.jsx(ae.Links,{})]})]})})},pt=()=>{const{formatMessage:n}=_(),{releaseId:e}=Me(),{toggleNotification:a}=ce(),{formatAPIError:t}=ue(),s=Qe(),[l,i]=me.useState(!1),[c,d]=me.useState(!1),{isLoading:o,data:g,isSuccess:x}=fe({id:e},{skip:!e}),{data:y,isLoading:m}=We(),[h,{isLoading:M}]=Ue(),[N]=Ve(),f=()=>{i(u=>!u)},E=()=>p?.timezone?p.timezone:y?.data.defaultTimezone?y.data.defaultTimezone:null,S=()=>d(u=>!u);if(o||m)return r.jsx(Re,{toggleEditReleaseModal:f,toggleWarningSubmit:S,children:r.jsx(Y.Loading,{})});if(!e)return r.jsx(pe,{to:".."});const p=x&&g?.data||null,z=p?.name||"",O=E(),v=p?.scheduledAt&&O?ha(p.scheduledAt,O):null,T=v?xe(v,"yyyy-MM-dd"):void 0,F=v?xe(v,"HH:mm"):"",P=async u=>{const b=await h({id:e,name:u.name,scheduledAt:u.scheduledAt,timezone:u.timezone});"data"in b?(a({type:"success",message:n({id:"content-releases.modal.release-updated-notification-success",defaultMessage:"Release updated."})}),f()):J(b.error)?a({type:"danger",message:t(b.error)}):a({type:"danger",message:n({id:"notification.error",defaultMessage:"An error occurred"})})},L=async()=>{const u=await N({id:e});"data"in u?s(".."):J(u.error)?a({type:"danger",message:t(u.error)}):a({type:"danger",message:n({id:"notification.error",defaultMessage:"An error occurred"})})};return r.jsxs(Re,{toggleEditReleaseModal:f,toggleWarningSubmit:S,children:[r.jsx(ft,{releaseId:e}),r.jsx(ma,{open:l,handleClose:f,handleSubmit:P,isLoading:o||M,initialValues:{name:z||"",scheduledAt:v,date:T,time:F,isScheduled:!!v,timezone:O}}),r.jsx(_e.Root,{open:c,onOpenChange:S,children:r.jsx(Ge,{onConfirm:L,children:n({id:"content-releases.dialog.confirmation-message",defaultMessage:"Are you sure you want to delete this release?"})})})]})},vt=()=>r.jsx(Y.Protect,{permissions:ge.main,children:r.jsxs(ga,{children:[r.jsx(be,{index:!0,element:r.jsx(xa,{})}),r.jsx(be,{path:":releaseId",element:r.jsx(pt,{})})]})});export{vt as App};
